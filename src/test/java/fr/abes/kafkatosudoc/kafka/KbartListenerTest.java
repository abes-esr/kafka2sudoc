package fr.abes.kafkatosudoc.kafka;

import com.fasterxml.jackson.databind.ObjectMapper;
import fr.abes.cbs.process.ProcessCBS;
import fr.abes.kafkatosudoc.service.BaconService;
import fr.abes.kafkatosudoc.service.SudocService;
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.junit.jupiter.api.BeforeEach;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;

@SpringBootTest(classes = {ProcessCBS.class, BaconService.class, SudocService.class, ObjectMapper.class})
class KbartListenerTest {
    @Autowired
    private ObjectMapper mapper;
    @MockBean
    ProcessCBS processCBS;
    @MockBean
    BaconService baconService;
    @MockBean
    SudocService sudocService;

    ConsumerRecord<String, String> unEnregistrementKafka;

    @BeforeEach
    void init() {
        this.unEnregistrementKafka = new ConsumerRecord<>(
                "packageKbart",
                0,
                42,
                "EMERALD_GLOBAL_111_2023-07-01.tsv",
                "{\"kbartDtos\":[{\"publication_title\":\"Lumières de l'an mil en Orléanais. Autour du millénaire d'Abbon de Fleury\",\"print_identifier\":\"978-2-503-51586-1\",\"online_identifier\":\"978-2-503-54578-3\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.STMH-EB.5.112642\",\"first_author\":\"\",\"title_id\":\"10.1484/M.STMH-EB.5.112642\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2004\",\"date_monograph_published_online\":\"30/03/2017\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Notter\",\"parent_publication_title_id\":\"\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"223686859\"},{\"publication_title\":\"Luxury and the Ethics of Greed in Early Modern Italy\",\"print_identifier\":\"978-2-503-58011-1\",\"online_identifier\":\"978-2-503-58012-8\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.EER-EB.5.115418\",\"first_author\":\"\",\"title_id\":\"10.1484/M.EER-EB.5.115418\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2018\",\"date_monograph_published_online\":\"30/03/2019\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Kovesi\",\"parent_publication_title_id\":\"eer-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Lyon dans l’Europe carolingienne\",\"print_identifier\":\"978-2-503-58235-1\",\"online_identifier\":\"978-2-503-58236-8\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.HAMA-EB.5.116379\",\"first_author\":\"\",\"title_id\":\"10.1484/M.HAMA-EB.5.116379\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2019\",\"date_monograph_published_online\":\"30/03/2019\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Bougard\",\"parent_publication_title_id\":\"hama-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Léon IX et son temps\",\"print_identifier\":\"978-2-503-51627-1\",\"online_identifier\":\"978-2-503-53689-7\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.ARTEM-EB.6.09070802050003050106020701\",\"first_author\":\"\",\"title_id\":\"10.1484/M.ARTEM-EB.6.09070802050003050106020701\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2007\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Tock\",\"parent_publication_title_id\":\"artem-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Lérins, une île sainte de l’Antiquité au Moyen Âge\",\"print_identifier\":\"978-2-503-51834-3\",\"online_identifier\":\"978-2-503-53729-0\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.CEM-EB.6.09070802050003050108030403\",\"first_author\":\"\",\"title_id\":\"10.1484/M.CEM-EB.6.09070802050003050108030403\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2009\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Codou\",\"parent_publication_title_id\":\"cem-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"165126612\"},{\"publication_title\":\"L’Université de Médecine de Montpellier et son rayonnement (XIIIe-XVe siècles)\",\"print_identifier\":\"978-2-503-51642-4\",\"online_identifier\":\"978-2-503-53745-0\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.DDA-EB.6.09070802050003050106040204\",\"first_author\":\"\",\"title_id\":\"10.1484/M.DDA-EB.6.09070802050003050106040204\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2004\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Granier\",\"parent_publication_title_id\":\"dda-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"151263485\"},{\"publication_title\":\"L’abbé Suger, le manifeste gothique de Saint-Denis et la pensée victorine\",\"print_identifier\":\"978-2-503-51259-4\",\"online_identifier\":\"978-2-503-53836-5\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.RME-EB.6.09070802050003050102050904\",\"first_author\":\"\",\"title_id\":\"10.1484/M.RME-EB.6.09070802050003050102050904\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2001\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Poirel\",\"parent_publication_title_id\":\"rme-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Re-Membering the Present\",\"print_identifier\":\"978-2-503-51516-8\",\"online_identifier\":\"978-2-503-55870-7\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.DISPUT-EB.5.105983\",\"first_author\":\"Dobozy\",\"title_id\":\"10.1484/M.DISPUT-EB.5.105983\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2005\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"\",\"parent_publication_title_id\":\"disput-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"22368807X\"},{\"publication_title\":\"Recent Developments in the Technical Examination of Early Netherlandish Painting: Methodology, Limitations and Perspectives\",\"print_identifier\":\"978-2-503-50993-8\",\"online_identifier\":\"978-2-503-53802-0\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.MAC-EB.6.09070802050003050009090308\",\"first_author\":\"\",\"title_id\":\"10.1484/M.MAC-EB.6.09070802050003050009090308\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2003\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Spronk\",\"parent_publication_title_id\":\"mac-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"151378150\"},{\"publication_title\":\"Recherches Augustiniennes et Patristiques\",\"print_identifier\":\"0484-0887\",\"online_identifier\":\"2507-0487\",\"date_first_issue_online\":\"30/03/1962\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"30/03/1962\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/loi/ra\",\"first_author\":\"\",\"title_id\":\"ra\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Institut d'Études Augustiniennes\",\"publication_type\":\"serial\",\"date_monograph_published_print\":\"\",\"date_monograph_published_online\":\"\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"\",\"parent_publication_title_id\":\"\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"197516254\"},{\"publication_title\":\"The Vocation of Service to God and Neighbour\",\"print_identifier\":\"978-2-503-50741-5\",\"online_identifier\":\"978-2-503-56158-5\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.IMR-EB.5.106763\",\"first_author\":\"\",\"title_id\":\"10.1484/M.IMR-EB.5.106763\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/1998\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Greatrex\",\"parent_publication_title_id\":\"imr-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"223687235\"},{\"publication_title\":\"Ad Ingenii Acuitionem. Studies in Honour of Alfonso Maierù\",\"print_identifier\":\"978-2-503-52532-7\",\"online_identifier\":\"978-2-503-56289-6\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.TEMA-EB.5.107162\",\"first_author\":\"\",\"title_id\":\"10.1484/M.TEMA-EB.5.107162\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2006\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Caroti\",\"parent_publication_title_id\":\"tema-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"223686549\"},{\"publication_title\":\"Duelling with the Past\",\"print_identifier\":\"978-2-503-52073-5\",\"online_identifier\":\"978-2-503-55898-1\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.SEM-EB.5.106273\",\"first_author\":\"Verbist\",\"title_id\":\"10.1484/M.SEM-EB.5.106273\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2010\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"\",\"parent_publication_title_id\":\"sem-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"22368712X\"},{\"publication_title\":\"Duns Scot à Paris, 1302-2002\",\"print_identifier\":\"978-2-503-51810-7\",\"online_identifier\":\"978-2-503-53917-1\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.TEMA-EB.6.09070802050003050108010007\",\"first_author\":\"\",\"title_id\":\"10.1484/M.TEMA-EB.6.09070802050003050108010007\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2004\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Boulnois\",\"parent_publication_title_id\":\"tema-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"D’Orient en Occident\",\"print_identifier\":\"978-2-503-54687-2\",\"online_identifier\":\"978-2-503-54738-1\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.CELAMA-EB.6.09070802050003050406080702\",\"first_author\":\"\",\"title_id\":\"10.1484/M.CELAMA-EB.6.09070802050003050406080702\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2014\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Foehr-Janssens\",\"parent_publication_title_id\":\"celama-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"181302748\"},{\"publication_title\":\"Early British Drama in Manuscript\",\"print_identifier\":\"978-2-503-57546-9\",\"online_identifier\":\"978-2-503-57547-6\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.BM-EB.5.113206\",\"first_author\":\"\",\"title_id\":\"10.1484/M.BM-EB.5.113206\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2019\",\"date_monograph_published_online\":\"30/03/2019\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Atkin\",\"parent_publication_title_id\":\"bm-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Early Medieval Ireland and Europe: Chronology, Contacts, Scholarship\",\"print_identifier\":\"978-2-503-55313-9\",\"online_identifier\":\"978-2-503-55420-4\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.STT-EB.5.108434\",\"first_author\":\"\",\"title_id\":\"10.1484/M.STT-EB.5.108434\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2015\",\"date_monograph_published_online\":\"30/03/2015\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Moran\",\"parent_publication_title_id\":\"stt-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"189507721\"},{\"publication_title\":\"Early Modern Urbanism and the Grid\",\"print_identifier\":\"978-2-503-54073-3\",\"online_identifier\":\"978-2-503-55632-1\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.ARCHMOD-EB.5.105685\",\"first_author\":\"\",\"title_id\":\"10.1484/M.ARCHMOD-EB.5.105685\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2011\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"Lombaerde\",\"parent_publication_title_id\":\"archmod-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"223687804\"},{\"publication_title\":\"Earning Dignity: Labour Conditions and Relations during the Century of the Black Death in Marseille\",\"print_identifier\":\"978-2-503-56552-1\",\"online_identifier\":\"978-2-503-56629-0\",\"date_first_issue_online\":\"\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/doi/book/10.1484/M.SEUH-EB.5.108451\",\"first_author\":\"Michaud\",\"title_id\":\"10.1484/M.SEUH-EB.5.108451\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"monograph\",\"date_monograph_published_print\":\"30/03/2016\",\"date_monograph_published_online\":\"30/03/2016\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"\",\"parent_publication_title_id\":\"seuh-eb\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"\"},{\"publication_title\":\"Troianalexandrina\",\"print_identifier\":\"1577-5003\",\"online_identifier\":\"2507-0495\",\"date_first_issue_online\":\"30/03/2001\",\"num_first_vol_online\":null,\"num_first_issue_online\":null,\"date_last_issue_online\":\"\",\"num_last_vol_online\":null,\"num_last_issue_online\":null,\"title_url\":\"https://www.brepolsonline.net/loi/troia\",\"first_author\":\"\",\"title_id\":\"troia\",\"embargo_info\":\"\",\"coverage_depth\":\"fulltext\",\"notes\":\"\",\"publisher_name\":\"Brepols Publishers\",\"publication_type\":\"serial\",\"date_monograph_published_print\":\"\",\"date_monograph_published_online\":\"\",\"monograph_volume\":null,\"monograph_edition\":\"\",\"first_editor\":\"\",\"parent_publication_title_id\":\"\",\"preceding_publication_title_id\":\"\",\"access_type\":\"P\",\"bestPpn\":\"204674549\"}]}\n"

        );
    }

    //TODO reflechir sur l'integration de _FORCE en suffixe de fichier à cet endroit du traitement

    //TODO : a revoir, méthode censée tester le listener, mais listener jamais appelé
   /** @Test
    void listenPackageKbartFromKafka() throws IllegalDateException, JsonProcessingException {
        PackageKbartDto packageKbartDto = new PackageKbartDto();

        packageKbartDto.setPackageName(CheckFiles.getPackageFromFilename(this.unEnregistrementKafka.key()));
        packageKbartDto.setProvider(CheckFiles.getProviderFromFilename(this.unEnregistrementKafka.key()));
        packageKbartDto.setDatePackage(CheckFiles.extractDate(this.unEnregistrementKafka.key()));
        PackageKbartDtoKafka packageKbartDtoKafka = mapper.readValue(this.unEnregistrementKafka.value(), PackageKbartDtoKafka.class);
        packageKbartDto.setLigneKbartDtos(packageKbartDtoKafka.getKbartDtos());


        //Version du package attendu
        ProviderPackageId providerPackageIdResultExpected = new ProviderPackageId("GLOBAL_111", new GregorianCalendar(2023, Calendar.JULY, 1).getTime(), 141);
        Provider providerResultExpected = new Provider(); providerResultExpected.setIdtProvider(141); providerResultExpected.setProvider("EMERALD"); providerResultExpected.setDisplayName("Emerald");
        ProviderPackage providerPackageExpected = new ProviderPackage(providerPackageIdResultExpected, 'N', providerResultExpected);
        List<ProviderPackage> listOfProviderPackageExpected = new ArrayList<>();
        listOfProviderPackageExpected.add(providerPackageExpected);

        //Mock : Interrogation de la BDD Bacon et retour d'une liste d'objets
        Mockito.when(baconService.findLastVersionOfPackage(packageKbartDto)).thenReturn(Lists.newArrayList(listOfProviderPackageExpected));

        //On considère que la dernière version retournée par la base date du 01 07 2023
        List<ProviderPackage> providerListReturnedByDatabase = baconService.findLastVersionOfPackage(packageKbartDto);
        //On regarde si il y a une version antérieure, la c'est le cas il a trouvé pour cette date une version en base, mêm jour, meme mois, meme annee, doit renvoyer true voir BaconServiceTest
        Mockito.when(baconService.isAnteriorVersionExist(providerListReturnedByDatabase, packageKbartDto.getDatePackage())).thenReturn(true);
        //TODO créer dans la couche utils les méthodes de tris des ppns
        System.out.println(providerListReturnedByDatabase);


        //Controle que le PackageKbartDto à été bien construit depuis l'enregistrement kafka
        Assertions.assertTrue(packageKbartDto.getLigneKbartDtos().get(0).getPublicationTitle().contains("Lumières"));


    }
*/

}